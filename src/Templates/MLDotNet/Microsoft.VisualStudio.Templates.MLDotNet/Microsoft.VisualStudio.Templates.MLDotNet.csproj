<!-- Copyright (c)  Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0.  See License.txt in the project root for license information. -->
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net461</TargetFramework>
    <IsProductComponent>false</IsProductComponent>
  </PropertyGroup>

  <ItemGroup>
    <None Include="Content\**" />
    <VSTemplate Include="Content\ConsoleApp\MLNETConsoleApplication.vstemplate">
      <OutputSubPath>Machine Learning</OutputSubPath>
    </VSTemplate>
  </ItemGroup>

  <ItemGroup>
    <None Include="Content\**" />
    <VSTemplate Include="Content\Library\MLNETModelLibrary.vstemplate">
      <OutputSubPath>Machine Learning</OutputSubPath>
    </VSTemplate>
  </ItemGroup>

  <!-- Nuget Packages To Include In VSIX -->
  <ItemGroup>
    <PackageReference Include="Microsoft.ML" Version="[$(MicrosoftMLVersion)]" />
    <PackageReference Include="Microsoft.ML.CpuMath" Version="[$(MicrosoftMLCpuMathVersion)]" />
    <PackageReference Include="Newtonsoft.Json" Version="[$(NewtonsoftJsonVersion)]" />
    <PackageReference Include="System.CodeDom" Version="[$(SystemCodeDomVersion)]" />
    <PackageReference Include="System.Reflection.Emit.Lightweight" Version="[$(SystemReflectionEmitLightweightVersion)]" />
    <PackageReference Include="System.Threading.Tasks.Dataflow" Version="[$(SystemThreadingTasksDataflowVersion)]" />
  </ItemGroup>
  
  <Target BeforeTargets="CreateVsixContainer" Name="MakeVsixOutputDirectory">
    <MakeDir Condition="!Exists('$(OutDir)$(VsixOutDirSuffix)')" Directories="$(OutDir)$(VsixOutDirSuffix)" />
  </Target>

  <Target Name="GetVsixTemplateItems" DependsOnTargets="ZipProjects;ZipItems">
    
    <!-- Locate packages -->
    <ItemGroup>
      <MicrosoftMLPackage
        Condition="Exists('C:\Program Files\dotnet\sdk\NuGetFallbackFolder\Microsoft.ML$(MicrosoftMLVersion)\Microsoft.ML.$(MicrosoftMLVersion).nupkg')"
        Include="C:\Program Files\dotnet\sdk\NuGetFallbackFolder\Microsoft.ML\$(MicrosoftMLVersion)\Microsoft.ML.$(MicrosoftMLVersion).nupkg" />
      <MicrosoftMLPackage
        Condition="Exists('$(NuGetPackageRoot)Microsoft.ML\$(MicrosoftMLVersion)\Microsoft.ML.$(MicrosoftMLVersion).nupkg')"
        Include="$(NuGetPackageRoot)Microsoft.ML\$(MicrosoftMLVersion)\Microsoft.ML.$(MicrosoftMLVersion).nupkg" />

      <MicrosoftMLCpuMathPackage
        Condition="Exists('C:\Program Files\dotnet\sdk\NuGetFallbackFolder\Microsoft.ML.CpuMath\$(MicrosoftMLCpuMathVersion)\Microsoft.ML.CpuMath.$(MicrosoftMLCpuMathVersion).nupkg')"
        Include="C:\Program Files\dotnet\sdk\NuGetFallbackFolder\Microsoft.ML.CpuMath\$(MicrosoftMLCpuMathVersion)\Microsoft.ML.CpuMath.$(MicrosoftMLCpuMathVersion).nupkg" />
      <MicrosoftMLCpuMathPackage 
        Condition="Exists('$(NuGetPackageRoot)Microsoft.ML.CpuMath\$(MicrosoftMLCpuMathVersion)\Microsoft.ML.CpuMath.$(MicrosoftMLCpuMathVersion).nupkg')"
        Include="$(NuGetPackageRoot)Microsoft.ML.CpuMath\$(MicrosoftMLCpuMathVersion)\Microsoft.ML.CpuMath.$(MicrosoftMLCpuMathVersion).nupkg" />

      <NewtonsoftJsonPackage
        Condition="Exists('C:\Program Files\dotnet\sdk\NuGetFallbackFolder\Newtonsoft.Json\$(NewtonsoftJsonVersion)\Newtonsoft.Json.$(NewtonsoftJsonVersion).nupkg')"
        Include="C:\Program Files\dotnet\sdk\NuGetFallbackFolder\Newtonsoft.Json\$(NewtonsoftJsonVersion)\Newtonsoft.Json.$(NewtonsoftJsonVersion).nupkg" />
      <NewtonsoftJsonPackage 
        Condition="Exists('$(NuGetPackageRoot)Newtonsoft.Json\$(NewtonsoftJsonVersion)\Newtonsoft.Json.$(NewtonsoftJsonVersion).nupkg')"
        Include="$(NuGetPackageRoot)Newtonsoft.Json\$(NewtonsoftJsonVersion)\Newtonsoft.Json.$(NewtonsoftJsonVersion).nupkg" />

      <SystemCodeDomPackage
        Condition="Exists('C:\Program Files\dotnet\sdk\NuGetFallbackFolder\System.CodeDom\$(SystemCodeDomVersion)\System.CodeDom.$(SystemCodeDomVersion).nupkg')"
        Include="C:\Program Files\dotnet\sdk\NuGetFallbackFolder\System.CodeDom\$(SystemCodeDomVersion)\System.CodeDom$(SystemCodeDomVersion).nupkg" />
      <SystemCodeDomPackage 
        Condition="Exists('$(NuGetPackageRoot)System.CodeDom\$(SystemCodeDomVersion)\System.CodeDom.$(SystemCodeDomVersion).nupkg')"
        Include="$(NuGetPackageRoot)System.CodeDom\$(SystemCodeDomVersion)\System.CodeDom.$(SystemCodeDomVersion).nupkg" />

      <SystemReflectionEmitLightweightPackage
        Condition="Exists('C:\Program Files\dotnet\sdk\NuGetFallbackFolder\System.Reflection.Emit.Lightweight\$(SystemReflectionEmitLightweightVersion)\System.Reflection.Emit.Lightweight.$(SystemReflectionEmitLightweightVersion).nupkg')"
        Include="C:\Program Files\dotnet\sdk\NuGetFallbackFolder\System.Reflection.Emit.Lightweight\$(SystemReflectionEmitLightweightVersion)\System.Reflection.Emit.Lightweight.$(SystemReflectionEmitLightweightVersion).nupkg" />
      <SystemReflectionEmitLightweightPackage 
        Condition="Exists('$(NuGetPackageRoot)System.Reflection.Emit.Lightweight\$(SystemReflectionEmitLightweightVersion)\System.Reflection.Emit.Lightweight.$(SystemReflectionEmitLightweightVersion).nupkg')"
        Include="$(NuGetPackageRoot)System.Reflection.Emit.Lightweight\$(SystemReflectionEmitLightweightVersion)\System.Reflection.Emit.Lightweight.$(SystemReflectionEmitLightweightVersion).nupkg" />

      <SystemThreadingTasksDataflowPackage
        Condition="Exists('C:\Program Files\dotnet\sdk\NuGetFallbackFolder\System.Threading.Tasks.Dataflow\$(SystemThreadingTasksDataflowVersion)\System.Threading.Tasks.Dataflow.$(SystemThreadingTasksDataflowVersion).nupkg')"
        Include="C:\Program Files\dotnet\sdk\NuGetFallbackFolder\System.Threading.Tasks.Dataflow\$(SystemThreadingTasksDataflowVersion)\System.Threading.Tasks.Dataflow.$(SystemThreadingTasksDataflowVersion).nupkg" />
      <SystemThreadingTasksDataflowPackage 
        Condition="Exists('$(NuGetPackageRoot)System.Threading.Tasks.Dataflow\$(SystemThreadingTasksDataflowVersion)\System.Threading.Tasks.Dataflow.$(SystemThreadingTasksDataflowVersion).nupkg')"
        Include="$(NuGetPackageRoot)System.Threading.Tasks.Dataflow\$(SystemThreadingTasksDataflowVersion)\System.Threading.Tasks.Dataflow.$(SystemThreadingTasksDataflowVersion).nupkg" />
    </ItemGroup>

    <ItemGroup>
      <VSIXSourceItem Include="@(IntermediateZipItem)">
        <VSIXSubPath>%(IntermediateZipItem.Filename)\%(IntermediateZipItem.Language)\%(IntermediateZipItem.OutputSubPath)\%(IntermediateZipItem.Culture)</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="@(IntermediateZipProject)">
        <VSIXSubPath>%(IntermediateZipProject.Filename)\%(IntermediateZipProject.Language)\%(IntermediateZipProject.OutputSubPath)\%(IntermediateZipProject.Culture)</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="@(MicrosoftMLPackage)">
        <VSIXSubPath>Packages</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="@(MicrosoftMLCpuMathPackage)">
        <VSIXSubPath>Packages</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="@(NewtonsoftJsonPackage)">
        <VSIXSubPath>Packages</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="@(SystemCodeDomPackage)">
        <VSIXSubPath>Packages</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="@(SystemReflectionEmitLightweightPackage)">
        <VSIXSubPath>Packages</VSIXSubPath>
      </VSIXSourceItem>
      <VSIXSourceItem Include="@(SystemThreadingTasksDataflowPackage)">
        <VSIXSubPath>Packages</VSIXSubPath>
      </VSIXSourceItem>
    </ItemGroup>
  </Target>
  
  <PropertyGroup>
    <GetVsixSourceItemsDependsOn>$(GetVsixSourceItemsDependsOn);GetVsixTemplateItems</GetVsixSourceItemsDependsOn>
  </PropertyGroup>
</Project>
